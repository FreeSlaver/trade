---
layout: page
title:  评论过滤拦截系统
category: program-system-design
tags: [程序系统,程序设计]
keywords:
description:
published:  true
---


最近在推广一个自己做的影视动漫，音乐小说类的导航类网站：[导航狗](https://dhgou.com)，然后发现一个特别有意思的事情，  
就我想到的方式都写在另外一片博文里面了[如何推广一个网站](/webmaster/HowTo-Popularize-My-Navigation-Website.html)  


**基于一个原则：在哪里提问的，就在哪里回答，这样用户获知信息的成本是最低的。**  

最先使用的方法非常low，也很常见的，就是我用了小号，直接在别人的文章下留言：  
强烈推荐一个影视类导航站：导航狗 https://dhgou.com，好，发出去没过10秒，直接被删除了。   

这明显的触发了垃圾评论的审核标准，带了URL链接，然后我再试：
强烈推荐一个影视类导航站：导航狗 dhgou.com，ok，发出去同样没活过10秒。  
然后我再试：强烈推荐一个影视类导航站：导航狗 dhgou，  
我不带.com，这样是不是就不会被识别出链接？？发出去，卧槽，就多活了10秒钟，20秒不到又被删了。

然后我再想，是不是这句话中的关键词？比如影视，导航站，这些关键词触发了？ok，我继续删除，我给它最后弄到只剩下： dhgou这5个字母，  
然后结果是：**评论的确没有被删除，但是只有本人看得到，** 其他人看不到，我换过账号看了的。

好吧，最后我又测了一把，输入一大段：告知：我的账号广告营销，被暂停一天限制使用。在此之前没有显示具体能输入多少评论？  
这是为了防止溢出攻击？

这个过程中我并没感到挫折，我觉得挺有意思的，再想他们是怎么实现的了？？   

我之前鼓捣的个人站点也不少，Wordpress，Jekyll，然后各种评论插件都试过，但是对于这个防范垃圾评论的实现机制却从来没思考过？
## 垃圾评论拦截过滤实现
第一个肯定是判断出评论中是否含有URL，地址信息，但是未必带http的就是，有的不带也是，用正则表达式（那正则表达式的实现原理是什么？）  
那我上面那个dhgou，就输入了5个字母，但是却只有自己能看到，是因为输入的东西太少了？？所以认定有推广嫌疑？？  


第二：除了这个，肯定还需要拦截过滤掉，政治反动，色情，民族主义等等一系列的敏感词汇，问题又来了：怎么分词？这个敏感词汇是人工录入，还是？应该是有敏感词库，  
能够直接导入。但是依然有问题是：有一些新的词汇，事件发生。

第三：有些人的头像就自带推广信息，或者用户签名，介绍之类的，然后评论说，看我签名，然后在签名中有那些推广信息，或者在个人详细介绍中有，  
反正就是各种漏洞，防不胜防，因为这几个区域的权限设置是不同的，比如个人签名中能带有公众号之类的信息。

这个既然有第一，第二，第三，当然需要做个过滤层级，漏斗形状，最好是像Netty那个channel，Java的IO那样用装饰者模式和适配器模式，   
就是管道不停的接下来，然后最后拦截过滤得到想要的，能通过的数据，结果。  

第四，用户在评论后发现自己的删除了，肯定会反复的不停提交相关的类似信息，能不能不经过这个管道过滤，直接给拦截了？？

第五：我发现还有一种方式是直接通过后台API，GET，POST方式直接提交，

## 技术实现
怎么进行技术上的实现？？首先用户输入一条评论，然后分词器分词？还是直接正则判断是否含有URL，这个评论最多多长了？如果非常长，正则的效率如何了？  
卧槽啊，真发现他妈处处都是学问，都是问题。  分词之后了？从数据库还是Redis中拿出敏感词汇，然后过滤了？还是说在前端写评论的时候，就用js不断检查？  

那比如我在加一条：zhonggong真是垃圾，这个虽然不是汉字，但是拼音大家都知道，这种又怎么处理了？？或者拼音不打那么全zhonguo，这种？  
是不是还要搞个政治中文关键字的，映射关系？？

然后我看知乎还能上传图片，能添加1个动图，N个Emougi，这个图片如何识别，坚定是否色情，暴力，反动，广告营销？？

对我看那个抖音还能用视频做评论，又是怎么弄的？一个视频，30秒的，你不可能鉴定之后才让通过把？也不能不鉴定，要是色情让其他人看到了咋弄？  
比较好的方案应该是异步处理，然后等第一个除了他自己意外的用户访问前，鉴定完，并设置栅栏。

其实这个评论扩大一点和发一篇博文没撒区别，甚至所有的都是通用的，也就是一个反xx系统。









