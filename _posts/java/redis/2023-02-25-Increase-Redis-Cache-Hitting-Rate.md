---
layout: page

title: Redis面试题-如何提高缓存命中率？
category: redis
categoryStr: redis
tags: [redis,interview]
keywords:
description:
---


我们知道Redis最多的应用场景就是作为缓存，那如何提高缓存的命中率就是提高性能的关键，同时也是提高使用缓存在整个系统中的价值。

这里要分几种情况：
## 1.是否已经知道哪些是热点数据？
是，那么我们启动redis时，提前将热点数据加载预热。
热点数据是否改变？是，那改变的频率是多少？需要将缓存过期时间设置的比改变的周期稍短一点，或者是主动更新还是被动更新缓存？
否的话，只需要第一次加载即可。

如果不知道哪些是热点数据，那是否知道缓存大部分使用的业务场景，比如经常查用户信息，最近的10笔订单信息等等，针对这些都可以进行优化
来提升缓存的命中率。


## 2.缓存的过期策略是怎么样的？
如果使用了不符合业务场景的淘汰策略，会将更有价值的缓存数据挤压出去，让无用的数据占据内存。
比如像这种以缓存命中率为关键的业务，但却使用了最先过期的策略。

## 3.缓存粒度
因为缓存的时效性，所以需要在更新数据之后使缓存失效或者主动更新缓存。缓存的粒度太大，那么其中更新一点信息就需要重新更新缓存，
所以缓存的粒度越小命中率越高，但是会提高缓存管理和代码的复杂度。举个例子，比如一个对象用hash来存储，那么其中某个字段变化，
我们就需要更新这个hash，但是如果将所有的字段和值分开为KV存储，这样只有当某一个字段的值改变我们才需要更新这一个字段的值，
而其他的不会改变，但是这会造成业务代码和缓存管理的复杂度。或者说一组对象我们存在List中，其中任何一个改变我们都需要
查询数据库，更新缓存，这降低了命中率，但是将里面的对象分开存储，只有其中改变了的缓存才需要查询数据库进行更新。


## 查询缓存命中率的方法
可以使用各种监控工具直接查询，也可以使用自带命令，如memcache的命中率 = get_hits/cmd_get，
redis的info命令获得keyspace_hits，keyspace_miss。
