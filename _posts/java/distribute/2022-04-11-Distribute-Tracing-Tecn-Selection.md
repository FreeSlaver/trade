---
layout: page

title: 分布式追踪技术选型
category: distribute
categoryStr: 分布式
tags: 
keywords:
description:
---


一.什么是分布式追踪？
Distribution Tracing，分布式追踪就是追踪一次事务请求在整个分布式业务中的调用路径和拓扑图。
举个简单的例子：用户上淘宝购买一件商品，首先会调用商品服务，再调用下单服务，
下单服务里面又会调用用户服务校验是否登陆，风控服务是否异常ip登陆，库存服务校验商品库存，
会员系统服务看是否888会员，优惠券积分服务判断能否抵扣等等，
之后下单完成之后会推送给商家服务，让他发货，商家会发货填写物流单号，物流公司会回传货物状态，
比如被签收了，用户退货了等等。

二.为什么要用分布式追踪？
在上面这个例子中，这么多步骤，比如下单服务，调用其他的5.6个服务，那一个出错了，可能就会抛异常，
即使没有异常，5.6个服务，那个耗时久了一点，整体的耗时加起来可能下单的http请求调用就超时了。
还有整个的购物流程调用链条这么长，具体每一步的耗时多久，能否在某些环节提高效率，节省时间，大大减少用户
等待收货的时间，提升购物的体验。另外服务间的调用具体耗时，异常统计，这都需要分布式追踪来处理。

三.分布式追踪技术选型？
所有的分布式追踪都是基于Google Dapper的论文开发而来的，主要有以下技术：
Uber：Jaeger。
Twitter：Zipkin。
Apache：SkyWalking（国内开源爱好者吴晟开源）。
Naver：Pinpoint（韩国公司开发）。
Elastic Stack：Elastic APM。
阿里：鹰眼。
大众点评：Cat。
京东：Hydra。

这么多实现，具体怎么进行技术选型，它们的优缺点是什么？怎么来考虑了？
其实还是要学会思考，我们来看看分布式追踪到底做了什么，如何来实现上面说的那些功能的。以我熟悉的Twitter的Zipkin为例：
首先1.Zipkin是支持多个语言的，比如PHP，GO，Python等，而Zipkin的Java实现叫Brave-instrument，
在这里找到第一个区分点：是否支持各种编程语言。
然后Java版的时候，首先需要添加Maven依赖，然后在需要埋点的地方，写上2行代码，
这里找到第二个区分点：对业务代码的侵入性程度。
然后你发现只能在方法里面添加代码，这个是第三个区分点：追踪的粒度大小，比如有的只能在前端请求拦截器中添加，只能追踪服务的粒度。
Zipkin埋点之后，会生成

