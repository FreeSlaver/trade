---
layout: page

title: Mysql数据库面试题
category: mysql
categoryStr: MySQL
tags: [interview]
keywords:
description:
---

1百万的数据量，log2n约等于20次磁盘IO，时间20*10=0.2s

## 1.索引有哪些类型？

### 主键索引
索引列中的值必须是唯一的，不允许有空值。

### 普通索引
MySQL中基本索引类型，没有什么限制，允许在定义索引的列中插入重复值和空值。

### 唯一索引
索引列中的值必须是唯一的，但是允许为空值。

### 全文索引
只能在文本类型CHAR,VARCHAR,TEXT类型字段上创建全文索引。字段长度比较大时，如果创建普通索引，在进行like模糊查询时效率比较低，这时可以创建全文索引。MyISAM和InnoDB中都可以使用全文索引。

### 空间索引
MySQL在5.7之后的版本支持了空间索引，而且支持OpenGIS几何数据模型。MySQL在空间索引这方面遵循OpenGIS几何数据模型规则。

### 前缀索引
在文本类型如CHAR,VARCHAR,TEXT类列上创建索引时，可以指定索引列的长度，但是数值类型不能指定。

其他（按照索引列数量分类）
### 单列索引

### 组合索引

组合索引的使用，需要遵循最左前缀匹配原则（最左匹配原则）

## 2.关于数据库中一些关键的计算
平衡二叉树的时间复杂度为log2n，1百万的数据量，log2n约等于20次磁盘IO，时间20*10=0.2s。

假如key为bigint=8字节，每个节点有两个指针，每个指针为4个字节，一个节点占用的空间16个字节（8+4*2=16）。

MySQL的InnoDB存储引擎一次IO会读取的一页（默认一页16K）的数据量，而二叉树一次IO有效数据量只有16字节，
每个节点可以存储1000个索引（16k/16=1000），这样就将二叉树改造成了多叉树，通过增加树的叉树，将树从高瘦变为矮胖。
构建1百万条数据，树的高度只需要2层就可以（1000*1000=1百万），，也就是说只需要2次磁盘IO就可以查询到数据。

这种数据结构我们称为B树，B树是一种多叉平衡查找树，如下图主要特点：

B树的节点中存储着多个元素，每个内节点有多个分叉。

节点中的元素包含键值和数据，节点中的键值从大到小排列。也就是说，在所有的节点都储存数据。

父节点当中的元素不会出现在子节点中。

所有的叶子结点都位于同一层，叶节点具有相同的深度，叶节点之间没有指针连接。
https://mmbiz.qpic.cn/mmbiz_png/uChmeeX1FpyhMB6mhAsgxJcPnltsesr46DHbNp9uWD0XtBIyzzAEs9QE5UCa6q1bBfiaH5RssfzDnU2UCsSibw2A/640?wx_fmt=png&wxfrom=5&wx_lazy=1&wx_co=1

B+树和B树最主要的区别在于非叶子节点是否存储数据的问题

B树：非叶子节点和叶子节点都会存储数据。
B+树：只有叶子节点才会存储数据，非叶子节点至存储键值。叶子节点之间使用双向指针连接，最底层的叶子节点形成了一个双向有序链表。
B+树的最底层叶子节点包含了所有的索引项。从图上可以看到，B+树在查找数据的时候，由于数据都存放在最底层的叶子节点上，所以每次查找都需要检索到叶子节点才能查询到数据。

所以在需要查询数据的情况下每次的磁盘的IO跟树高有直接的关系，但是从另一方面来说，由于数据都被放到了叶子节点，放索引的磁盘块锁存放的索引数量是会跟这增加的，相对于B树来说，B+树的树高理论上情况下是比B树要矮的。
    